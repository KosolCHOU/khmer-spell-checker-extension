
import sys
import os
import json
import random

sys.path.append(os.path.abspath(os.path.join(os.getcwd(), '..')))
from landing.spell_checker_advanced import check_spelling

TOPICS = [
    "Technology & Innovation",
    "Education & Development",
    "Healthcare & Monk",
    "Agriculture & Economy",
    "Environment & Royal",
    "Culture & Arts",
    "Sports & Youth",
    "Business & Trade",
    "Transportation & Infrastructure",
    "Religion & Community",
]

# Simple sentence templates (two sentences per topic) with intentional spacing/punctuation issues
SENTENCE_TEMPLATES = {
    "Technology & Innovation": [
        "ក្រសួងអភិវឌ្ឍន៍ឌីជីថលកំពុងអនុវត្តគម្រោងធំៗដើម្បីលើកកម្ពស់វិស័យបច្ចេកវិទ្យាព័ត៌មាននៅទូទាំងប្រទេស។ ព្រះមហាក្សត្រហូបអាហារព្រឹកជាមួយក្រុមគ្រួសារហើយមានព្រះបន្ទូលអំពីសារៈសំខាន់នៃការអភិវឌ្ឍប្រទេសជាតិ។",
        "ក្រុមអ្នកវិទ្យាសាស្ត្រកំពុងស្រាវជ្រាវអំពី AI និង blockchain ដើម្បីបង្កើតសេវាកម្មថ្មី។ ការប្រើប្រាស់បច្ចេកវិទ្យាថ្មីនេះអាចជួយកែលម្អសេដ្ឋកិច្ច។"
    ],
    "Education & Development": [
        "លោកគ្រូបង្រៀនសិស្សអំពីប្រវត្តិសាស្ត្រខ្មែរនិងពិសាអាហារថ្ងៃត្រង់ជាមួយសិស្សានុសិស្សនៅក្នុងបរិវេណសាលា។ គម្រោងអភិវឌ្ឍនេះនឹងជួយកុមារក្រីក្រឱ្យទទួលបានការអប់រំប្រកបដោយគុណភាពខ្ពស់ដែរ។",
        "សាលាថ្មីត្រូវបានបើកដំណើរការដោយក្រសួងអប់រំ ដើម្បីផ្តល់ឱកាសសិក្សាថ្មីៗសម្រាប់កុមារទាំងអស់។"
    ],
    "Healthcare & Monk": [
        "ព្រះសង្ឃអង្គនោះស្លាប់ដោយសារជំងឺធ្ងន់ធ្ងរនៅវត្តព្រះធាតុហើយអ្នកភូមិទាំងអស់មកចូលរួមក្នុងពិធីបុណ្យសព។ ការអនុវត្តន៍គម្រោងសុខាភិបាលសហគមន៍ត្រូវការការគាំទ្រពីក្រសួងសុខាភិបាលនិងអង្គការសុខភាពពិភពលោក។",
        "មន្ទីរពេទ្យកំពុងអនុវត្តន៍កម្មវិធីវ៉ាក់សាំងថ្មីសម្រាប់ជនរងគ្រោះ។"
    ],
    "Agriculture & Economy": [
        "កសិករត្រូវអភិវឌ្ឍន៍ដីធ្លីរបស់ខ្លួនដើម្បីបង្កើនទិន្នផលកសិកម្មនិងធ្វើការជាមួយអ្នកជំនាញពីក្រសួងកសិកម្ម។ ឯកឧត្តមសោយបាយថ្ងៃត្រង់ជាមួយប្រតិភូអន្តរជាតិហើយមានប្រសាសន៍អំពីនយោបាយសេដ្ឋកិច្ចថ្មី។",
        "ការវិនិយោគក្នុងវិស័យកសិកម្មកំពុងកើនឡើង ដោយមានការគាំទ្រពីរដ្ឋាភិបាល។"
    ],
    "Environment & Royal": [
        "ស្ដេចយាងទៅទស្សនាឧទ្យានជាតិនិងថ្វាយអំណោយដល់អ្នករក្សាព្រៃឈើដែលការពារធនធានធម្មជាតិ។ គេត្រូវការការអភិរក្សព្រៃឈើនិងសត្វព្រៃដើម្បីរក្សាតុល្យភាពបរិស្ថាននៅតំបន់ជនបទ។",
        "ព្រះបរមរាជាណាចក្របានចេញសេចក្តីសំរេចដើម្បីបង្កើនការពារបរិស្ថាន។"
    ],
    "Culture & Arts": [
        "ខ្ញុំញ៉ាំបាយនិងមើលការសម្តែងរបាំប្រពៃណីខ្មែរនៅមជ្ឈមណ្ឌលវប្បធម៌ជាមួយមិត្តភក្តិរបស់ខ្ញុំ។ លោកតាឆាន់បាយព្រឹកហើយដេកសម្រាកនៅក្នុងបន្ទប់របស់គាត់ដែលមានខ្យល់អាកាសត្រជាក់។",
        "ការបង្ហាញសិល្បៈសព្វថ្ងៃបានបង្ហាញពីសម្តែងនៃសិល្បៈប្រពៃណី និងសិល្បៈទំនើប។"
    ],
    "Sports & Youth": [
        "កុមារប្រាំនាក់កំពុងហាត់ប្រាណបាល់ទាត់នៅទីលានកីឡាហើយគ្រូបង្វឹកពិសាទឹកជាមួយពួកគេ។ ការវិវត្តន៍នៃកីឡាជាតិត្រូវការការគាំទ្រពីរដ្ឋាភិបាលនិងវិស័យឯកជន។",
        "ក្រុមយុវជនបានចូលរួមប្រកួតបាល់ទាត់ក្នុងព្រឹត្តិការណ៍អន្តរជាតិ។"
    ],
    "Business & Trade": [
        "អ្នកជំនួញត្រូវអនុវត្តច្បាប់ពាណិជ្ជកម្មនិងបង់ពន្ធតាមកាលកំណត់ដើម្បីជៀសវាងបញ្ហាផ្លូវច្បាប់។ ក្រុមប្រឹក្សាភិបាលក្រុមហ៊ុនមានសង្ឃដីកាអំពីយុទ្ធសាស្ត្រអភិវឌ្ឍថ្មីសម្រាប់ឆ្នាំក្រោយ។",
        "ការប្រកួតប្រជុំអន្ដរជាតិក្នុងវិស័យពាណិជ្ជកម្មបានបង្ហាញពីឱកាសថ្មីៗសម្រាប់ក្រុមហ៊ុន។"
    ],
    "Transportation & Infrastructure": [
        "រដ្ឋាភិបាលកំពុងវិវត្តន៍ប្រព័ន្ធដឹកជញ្ជូនសាធារណៈនិងសាងសង់ផ្លូវថ្មីនៅតាមខេត្តនានា។ លោកជំទាវឱ្យអំណោយដល់កុមារក្រីក្រនិងទស្សនាគម្រោងអភិវឌ្ឍហេដ្ឋារចនាសម្ព័ន្ធ។",
        "គម្រោងដាក់ស្ពានថ្មីត្រូវបានចាប់ផ្តើម ដើម្បីកាត់បន្ថយការរអាក់រអួលក្នុងការដឹកជញ្ជូន។"
    ],
    "Religion & Community": [
        "ភិក្ខុសឹងនៅវត្តហើយមានសង្ឃដីកាជាមួយអ្នកសាសនិកអំពីធម៌វិន័យនិងការរស់នៅប្រកបដោយសីលធម៌។ នៃអនុវត្តន៍ការងារសង្គមកិច្ចនេះត្រូវការការចូលរួមពីសហគមន៍ទាំងមូល។",
        "សហគមន៍បានរៀបចំកម្មវិធីអប់រំសាសនា ដើម្បីបង្កើតសមភាព និងការយល់ដឹងជាមួយគ្នា។"
    ]
}

def run_long_tests():
    print("=" * 80)
    print("LONG SENTENCE TESTS – TWO KHAN PER TOPIC")
    print("=" * 80)
    total = 0
    passed = 0
    for topic, sentences in SENTENCE_TEMPLATES.items():
        for idx, txt in enumerate(sentences, 1):
            total += 1
            print(f"\n--- Topic: {topic} (Sentence {idx}) ---")
            result = check_spelling(txt)
            errors = result.get('errors', {})
            print(f"Tokens ({len(result.get('tokens', []))}): {' '.join(result.get('tokens', [])[:20])}...")
            print(f"Errors ({len(errors)}):")
            for e_idx, e in errors.items():
                print(f"  [{e_idx}] {e['original']} → {e['suggestions'][0]} (conf:{e['confidence']:.2f})")
            # Simple pass criteria: at least one error detected for each intentional case
            if errors:
                passed += 1
                print("✅ PASS")
            else:
                print("⚠️  NO ERRORS DETECTED (may be false negative)")
    print("\n" + "=" * 80)
    print(f"SUMMARY: {passed}/{total} sentences produced errors (expected)")
    print("=" * 80)

if __name__ == "__main__":
    run_long_tests()
